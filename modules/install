#!/bin/sh
set -e
if [ "$(id -u)" -ne 0 ]; then
    echo "need root"
    exit 1
fi
pkg="$1"
if [ ! -d "/teto/pkgs/build/$pkg" ]; then
    echo "$pkg not found"
    exit 1
fi
found=0
while IFS= read -r line; do
    [ "$line" = "$pkg" ] && found=1 && break
done < /teto/pkgs/installed
if [ "$found" -eq 1 ]; then
    echo "$pkg is already installed"
    exit 1
fi
cd /teto/env
sh /teto/pkgs/build/$pkg/build
sed -i "\$a $pkg" /teto/pkgs/installed
echo "$pkg was installed"
